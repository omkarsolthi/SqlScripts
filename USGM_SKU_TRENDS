insert into table ogoud.sku_trends select b.date_id, b.pub_sts, count(distinct b.product_id) P_cnt, sum(b.1pocnt) dotcom_offer_cnt, sum(b.3pocnt) MP_offer_cnt, sum(b.1pcnt) dotcom_Prod_cnt, sum(b.3pcnt) MP_Prod_cnt, sum(b.putcnt) PUT_cnt, sum(b.s2hcnt) S2H_cnt, sum(b.s2scnt) S2S_cnt, count(b.barcode) TOP1MM_cnt, FROM_UNIXTIME(UNIX_TIMESTAMP(),'yyyy-MM-dd') datelocal from (select a.product_id, a.date_id, t.barcode, a.pub_sts,  sum(a.1p) 1pocnt, sum(a.3p) 3pocnt, max(a.1p) 1pcnt, max(a.3p) 3pcnt, max(a.put) putcnt, max(a.s2h) s2hcnt, max(a.s2s) s2scnt from(select  u.product_id, u.date_id, case when u.product_identifier_type='DOTCOM_OFFER' then 1 else 0 end as 1p, case when u.product_identifier_type='SELLER_OFFER' then 1 else 0 end as 3p,  get_json_object(u.product_offer_panama_json, '$.offer.productId.upc') UPC, get_json_object(u.product_offer_json,'$.offerPublishStatus') Pub_sts, case when u.product_identifier_type='DOTCOM_OFFER' and get_json_object(u.oscar_json,'$.result.offerAttributes.entry.logistics.isPutEligible')='true' then 1 else 0 end as PUT, case when u.product_identifier_type='DOTCOM_OFFER' and get_json_object(u.oscar_json,'$.result.offerAttributes.entry.logistics.isS2HEligible')='true' then 1 else 0 end as S2H, case when u.product_identifier_type='DOTCOM_OFFER' and get_json_object(u.oscar_json,'$.result.offerAttributes.entry.logistics.isS2SEligible')='true' then 1 else 0 end as S2S from catint.uber_flat_product_daily u  where u.date_id=${hiveconf:yday} and u.product_identifier_type!='PRIMARY_PRODUCT_OFFER' and get_json_object(u.product_offer_json,'$.offerLifecycleStatus')='ACTIVE') a left join (select barcode from jetanalytics_assortment.top_mm_go_get where is_top_1m = 1 ) t on t.barcode=a.UPC group by a.product_id, a.date_id, t.barcode, a.pub_sts) b group by b.date_id, b.pub_sts;